<script>
const messages = document.getElementById("messages");
const clientName = localStorage.getItem("clientName") || "Client";

/* ===== OUTILS D‚ÄôAFFICHAGE ===== */
function bot(text){
  messages.innerHTML += `<div class="msg bot">${text}</div>`;
  messages.scrollTop = messages.scrollHeight;
}
function user(text){
  messages.innerHTML += `<div class="msg user">${text}</div>`;
  messages.scrollTop = messages.scrollHeight;
}

/* ===== MESSAGE D‚ÄôACCUEIL ===== */
bot(`Bonjour <b>${clientName}</b> üëã<br>
Je suis l‚Äôassistant intelligent de <b>WaveBank</b>.<br>
Posez-moi vos questions bancaires.`);

/* ===== ENVOI MESSAGE ===== */
function send(){
  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if(!text) return;
  user(text);
  input.value = "";
  setTimeout(() => analyze(text.toLowerCase()), 500);
}

/* ===== IA : ANALYSE INTELLIGENTE ===== */
function analyze(text){

  /* --- INTENTIONS --- */
  const intents = {
    virement: ["virement","transfer","envoyer","re√ßu","reception"],
    retrait: ["retrait","retirer","argent","atm","distributeur"],
    carte: ["carte","cb","visa","mastercard","bloqu√©e","bloque"],
    solde: ["solde","compte","argent","balance"],
    conseiller: ["conseiller","agent","humain","assistance"],
    ia: ["ia","intelligence","robot","automatique"]
  };

  function detect(intent){
    return intents[intent].some(word => text.includes(word));
  }

  /* ===== R√âPONSES IA ===== */

  if(detect("virement")){
    if(text.includes("pas") || text.includes("bloqu√©") || text.includes("√©chou√©")){
      bot("Analyse effectu√©e ‚úÖ<br><br>Un virement non ex√©cut√© peut √™tre caus√© par :<br>‚Ä¢ informations incorrectes<br>‚Ä¢ contr√¥le de s√©curit√©<br>‚Ä¢ d√©lai interbancaire<br><br><b>Action recommand√©e :</b> intervention humaine.");
    } else {
      bot("Les virements WaveBank sont g√©n√©ralement instantan√©s.<br>Si le b√©n√©ficiaire est correct, l‚Äôop√©ration est trait√©e automatiquement.");
    }
    return;
  }

  if(detect("retrait")){
    bot("Un refus de retrait peut √™tre li√© √† :<br>‚Ä¢ solde insuffisant<br>‚Ä¢ plafond atteint<br>‚Ä¢ restriction temporaire<br><br>Une v√©rification humaine est recommand√©e.");
    return;
  }

  if(detect("carte")){
    if(text.includes("bloqu")){
      bot("Carte bloqu√©e d√©tect√©e ‚ö†Ô∏è<br>Pour des raisons de s√©curit√©, une IA ne peut pas d√©bloquer une carte bancaire.<br><b>Un conseiller humain est obligatoire.</b>");
    } else {
      bot("Votre carte permet paiements et retraits.<br>Les param√®tres sensibles sont prot√©g√©s par contr√¥le humain.");
    }
    return;
  }

  if(detect("solde")){
    bot("Pour des raisons de confidentialit√© bancaire, une IA ne peut pas afficher le solde r√©el.<br>Veuillez consulter votre espace client s√©curis√©.");
    return;
  }

  if(detect("conseiller")){
    bot("Un conseiller humain peut prendre le relais.<br>Disponibilit√© : 08h‚Äì18h (jours ouvr√©s).");
    return;
  }

  if(detect("ia")){
    bot("Je suis une intelligence artificielle d‚Äôassistance bancaire.<br>Je vous aide √† comprendre, mais les d√©cisions critiques restent humaines.");
    return;
  }

  /* ===== PAR D√âFAUT ===== */
  bot("Je n‚Äôai pas identifi√© clairement votre demande.<br>Pouvez-vous reformuler ou pr√©ciser votre probl√®me bancaire ?");
}
</script>
